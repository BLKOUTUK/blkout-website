import{a as d}from"./vendor-DdOSwMW5.js";import{j as r,m as g}from"./animations-D8c5Gb9V.js";import{L as x,T as w,R as _,H as j,B as E}from"./ui-gr-RCNrC.js";import{c as N}from"./supabase-quee5MUx.js";const S="https://bgjengudzfickgomjqmz.supabase.co",C="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJnamVuZ3VkemZpY2tnb21qcW16Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU2MTI3NjcsImV4cCI6MjA3MTE4ODc2N30.kYQ2oFuQBGmu4V_dnj_1zDMDVsd-qpDZJwNvswzO6M0",a=N(S,C,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0},realtime:{params:{eventsPerSecond:10}}}),f={async getCurrentUser(){const{data:{user:t},error:e}=await a.auth.getUser();return{user:t,error:e}},async signIn(t,e){const{data:n,error:c}=await a.auth.signInWithPassword({email:t,password:e});return{data:n,error:c}},async signOut(){const{error:t}=await a.auth.signOut();return{error:t}},async safeQuery(t){try{const e=await t();return e.error?(console.error("Supabase query error:",e.error),{data:null,error:e.error}):e}catch(e){return console.error("Unexpected error in Supabase query:",e),{data:null,error:e}}},async testConnection(){try{const{data:t,error:e}=await a.from("events").select("id").limit(1);return{connected:!e,error:e}}catch(t){return{connected:!1,error:t}}},async getEvents(t={}){let e=a.from("events").select("*").order("event_date",{ascending:!0});return t.status&&(e=e.eq("status",t.status)),t.category&&(e=e.ilike("tags",`%${t.category}%`)),t.location&&(e=e.ilike("location",`%${t.location}%`)),t.limit&&(e=e.limit(t.limit)),t.offset&&(e=e.range(t.offset,t.offset+(t.limit||20)-1)),this.safeQuery(()=>e)},async createEvent(t){return this.safeQuery(()=>a.from("events").insert(t).select().single())},async updateEvent(t,e){return this.safeQuery(()=>a.from("events").update(e).eq("id",t).select().single())},async deleteEvent(t){return this.safeQuery(()=>a.from("events").delete().eq("id",t))},async getArticles(t={}){let e=a.from("newsroom_articles").select("*").order("published_at",{ascending:!1});return t.status&&(e=e.eq("status",t.status)),t.category&&(e=e.eq("category",t.category)),t.featured!==void 0&&(e=e.eq("featured",t.featured)),t.limit&&(e=e.limit(t.limit)),t.offset&&(e=e.range(t.offset,t.offset+(t.limit||20)-1)),this.safeQuery(()=>e)},async createArticle(t){return this.safeQuery(()=>a.from("newsroom_articles").insert(t).select().single())},async updateArticle(t,e){return this.safeQuery(()=>a.from("newsroom_articles").update(e).eq("id",t).select().single())},async deleteArticle(t){return this.safeQuery(()=>a.from("newsroom_articles").delete().eq("id",t))},async getContacts(t={}){let e=a.from("contacts").select("*").order("created_at",{ascending:!1});return t.verified!==void 0&&(e=e.eq("verified",t.verified)),t.limit&&(e=e.limit(t.limit)),this.safeQuery(()=>e)},async createContact(t){return this.safeQuery(()=>a.from("contacts").insert(t).select().single())},subscribeToEvents(t){return a.channel("events-changes").on("postgres_changes",{event:"*",schema:"public",table:"events"},e=>{console.log("ðŸ”´ Event change detected:",e),t(e)}).subscribe()},subscribeToArticles(t){return a.channel("articles-changes").on("postgres_changes",{event:"*",schema:"public",table:"newsroom_articles"},e=>{console.log("ðŸ“° Article change detected:",e),t(e)}).subscribe()},async getCommunityStats(){const[t,e,n]=await Promise.all([this.safeQuery(()=>a.from("events").select("status, event_date")),this.safeQuery(()=>a.from("newsroom_articles").select("status, category")),this.safeQuery(()=>a.from("contacts").select("verified"))]),c=new Date().toISOString().split("T")[0];return{events:{total:t.data?.length||0,published:t.data?.filter(o=>o.status==="published").length||0,upcoming:t.data?.filter(o=>o.status==="published"&&o.event_date>=c).length||0},articles:{total:e.data?.length||0,published:e.data?.filter(o=>o.status==="published").length||0,byCategory:e.data?.reduce((o,s)=>(o[s.category]=(o[s.category]||0)+1,o),{})||{}},community:{totalContacts:n.data?.length||0,verifiedContacts:n.data?.filter(o=>o.verified).length||0}}},async uploadFile(t,e="articles"){const n=t.name.split(".").pop(),c=`${Math.random()}.${n}`,o=`${e}/${c}`,{data:s,error:i}=await a.storage.from("media").upload(o,t);if(i)return{data:null,error:i};const{data:{publicUrl:l}}=a.storage.from("media").getPublicUrl(o);return{data:{path:o,url:l},error:null}},async getGovernanceProposals(t={}){let e=a.from("governance_proposals_with_votes").select("*").order("created_at",{ascending:!1});return t.status&&(e=e.eq("status",t.status)),t.category&&(e=e.eq("category",t.category)),t.limit&&(e=e.limit(t.limit)),t.offset&&(e=e.range(t.offset,t.offset+(t.limit||20)-1)),this.safeQuery(()=>e)},async createGovernanceProposal(t){const{user:e}=await this.getCurrentUser();if(!e)return{data:null,error:{message:"User must be authenticated to create proposals"}};const n={...t,proposer_id:e.id};return this.safeQuery(()=>a.from("governance_proposals").insert(n).select().single())},async updateGovernanceProposal(t,e){return this.safeQuery(()=>a.from("governance_proposals").update(e).eq("id",t).select().single())},async voteOnProposal(t,e,n){const{user:c}=await this.getCurrentUser();if(!c)return{data:null,error:{message:"User must be authenticated to vote"}};const o={proposal_id:t,voter_id:c.id,vote:e,comment:n};return this.safeQuery(()=>a.from("proposal_votes").upsert(o,{onConflict:"proposal_id,voter_id"}).select().single())},async getCommunityMeetings(t={}){let e=a.from("community_meetings").select("*").order("date",{ascending:!1});return t.type&&(e=e.eq("type",t.type)),t.status&&(e=e.eq("status",t.status)),t.limit&&(e=e.limit(t.limit)),t.offset&&(e=e.range(t.offset,t.offset+(t.limit||20)-1)),this.safeQuery(()=>e)},async createCommunityMeeting(t){const{user:e}=await this.getCurrentUser(),n={...t,created_by:e?.id};return this.safeQuery(()=>a.from("community_meetings").insert(n).select().single())},async updateCommunityMeeting(t,e){return this.safeQuery(()=>a.from("community_meetings").update(e).eq("id",t).select().single())},async getGovernanceDocuments(t={}){let e=a.from("governance_documents").select("*").order("uploaded_date",{ascending:!1});return t.type&&(e=e.eq("type",t.type)),t.status&&(e=e.eq("status",t.status)),t.meetingId&&(e=e.eq("meeting_id",t.meetingId)),t.proposalId&&(e=e.eq("proposal_id",t.proposalId)),t.limit&&(e=e.limit(t.limit)),t.offset&&(e=e.range(t.offset,t.offset+(t.limit||20)-1)),this.safeQuery(()=>e)},async uploadGovernanceDocument(t){const{user:e}=await this.getCurrentUser(),n={...t,uploaded_by:e?.id,uploaded_by_name:e?.user_metadata?.full_name||e?.email||"Unknown User"};return this.safeQuery(()=>a.from("governance_documents").insert(n).select().single())},async updateGovernanceDocument(t,e){return this.safeQuery(()=>a.from("governance_documents").update(e).eq("id",t).select().single())},async deleteGovernanceDocument(t){return this.safeQuery(()=>a.from("governance_documents").delete().eq("id",t))},async getCommunityMembers(t={}){let e=a.from("community_members").select("*").order("contribution_score",{ascending:!1});return t.role&&(e=e.eq("role",t.role)),t.verified!==void 0&&(e=e.eq("verified",t.verified)),t.limit&&(e=e.limit(t.limit)),t.offset&&(e=e.range(t.offset,t.offset+(t.limit||20)-1)),this.safeQuery(()=>e)},async updateCommunityMember(t,e){return this.safeQuery(()=>a.from("community_members").update(e).eq("id",t).select().single())},async getProposalDiscussions(t){return this.safeQuery(()=>a.from("proposal_discussions").select("*").eq("proposal_id",t).order("created_at",{ascending:!0}))},async createProposalDiscussion(t){const{user:e}=await this.getCurrentUser(),n={...t,user_id:e?.id,user_name:e?.user_metadata?.full_name||e?.email||"Anonymous"};return this.safeQuery(()=>a.from("proposal_discussions").insert(n).select().single())},subscribeToProposals(t){return a.channel("governance-proposals-changes").on("postgres_changes",{event:"*",schema:"public",table:"governance_proposals"},e=>{console.log("ðŸ›ï¸ Governance proposal change detected:",e),t(e)}).on("postgres_changes",{event:"*",schema:"public",table:"proposal_votes"},e=>{console.log("ðŸ—³ï¸ Proposal vote change detected:",e),t(e)}).subscribe()},subscribeToMeetings(t){return a.channel("community-meetings-changes").on("postgres_changes",{event:"*",schema:"public",table:"community_meetings"},e=>{console.log("ðŸ“… Community meeting change detected:",e),t(e)}).subscribe()},subscribeToDocuments(t){return a.channel("governance-documents-changes").on("postgres_changes",{event:"*",schema:"public",table:"governance_documents"},e=>{console.log("ðŸ“„ Governance document change detected:",e),t(e)}).subscribe()},subscribeToDiscussions(t,e){return a.channel(`proposal-discussions-${t}`).on("postgres_changes",{event:"*",schema:"public",table:"proposal_discussions",filter:`proposal_id=eq.${t}`},n=>{console.log("ðŸ’¬ Proposal discussion change detected:",n),e(n)}).subscribe()},async getGovernanceStats(){const[t,e,n,c]=await Promise.all([this.safeQuery(()=>a.rpc("calculate_proposal_stats")),this.safeQuery(()=>a.from("community_members").select("role, verified, contribution_score")),this.safeQuery(()=>a.from("community_meetings").select("status, type, date")),this.safeQuery(()=>a.from("governance_documents").select("type, status, is_public"))]),o=new Date().toISOString().split("T")[0];return{proposals:t.data?.[0]||{total_proposals:0,active_proposals:0,approved_proposals:0,average_participation:0,total_eligible_voters:0},members:{total:e.data?.length||0,verified:e.data?.filter(s=>s.verified).length||0,byRole:e.data?.reduce((s,i)=>(s[i.role]=(s[i.role]||0)+1,s),{})||{},averageContribution:e.data?.reduce((s,i)=>s+(i.contribution_score||0),0)/(e.data?.length||1)||0},meetings:{total:n.data?.length||0,completed:n.data?.filter(s=>s.status==="completed").length||0,upcoming:n.data?.filter(s=>s.status==="scheduled"&&s.date>=o).length||0,byType:n.data?.reduce((s,i)=>(s[i.type]=(s[i.type]||0)+1,s),{})||{}},documents:{total:c.data?.length||0,published:c.data?.filter(s=>s.status==="published").length||0,public:c.data?.filter(s=>s.is_public).length||0,byType:c.data?.reduce((s,i)=>(s[i.type]=(s[i.type]||0)+1,s),{})||{}}}}},T=(t={})=>{const[e,n]=d.useState([]),[c,o]=d.useState(!0),[s,i]=d.useState(null),l=d.useCallback(async()=>{try{o(!0),i(null);const m=await f.getEvents(t);if(m.error){i(m.error.message||"Failed to fetch events"),n([]);return}n(m.data||[])}catch(m){const p=m instanceof Error?m.message:"Unknown error";console.error("Events fetch error:",m),i(p),n([])}finally{o(!1)}},[JSON.stringify(t)]);return d.useEffect(()=>{l();const m=f.subscribeToEvents(()=>{l()});return()=>{m.unsubscribe()}},[l]),{events:e,loading:c,error:s,refetch:l,createEvent:async m=>{try{const p=await f.createEvent(m);if(p.error)throw new Error(p.error.message||"Failed to create event");return await l(),p.data}catch(p){throw p}},updateEvent:async(m,p)=>{try{const b=await f.updateEvent(m,p);if(b.error)throw new Error(b.error.message||"Failed to update event");return await l(),b.data}catch(b){throw b}},deleteEvent:async m=>{try{const p=await f.deleteEvent(m);if(p.error)throw new Error(p.error.message||"Failed to delete event");await l()}catch(p){throw p}}}},O=()=>{const[t,e]=d.useState(null),[n,c]=d.useState(!0),[o,s]=d.useState(null),i=d.useCallback(async()=>{try{c(!0),s(null);const l=await f.getCommunityStats();e(l)}catch(l){s(l instanceof Error?l.message:"Failed to fetch community stats")}finally{c(!1)}},[]);return d.useEffect(()=>{i();const l=setInterval(i,300*1e3);return()=>clearInterval(l)},[i]),{stats:t,loading:n,error:o,refetch:i}},P=()=>{const[t,e]=d.useState(!1),[n,c]=d.useState(null);return{uploadFile:async(s,i="articles")=>{try{if(e(!0),c(null),s.size>5*1024*1024)throw new Error("File too large. Please keep under 5MB for community accessibility.");if(!["image/jpeg","image/png","image/webp","image/gif"].includes(s.type))throw new Error("Only JPEG, PNG, WebP, and GIF images are supported.");const u=await f.uploadFile(s,i);if(u.error)throw new Error(u.error.message||"Failed to upload file");return u.data}catch(l){throw c(l instanceof Error?l.message:"Upload failed"),l}finally{e(!1)}},uploading:t,error:n}},D=()=>{const[t,e]=d.useState(null),[n,c]=d.useState(!0),[o,s]=d.useState(null);return d.useEffect(()=>{f.getCurrentUser().then(({user:y,error:h})=>{e(y),s(h?.message||null),c(!1)});const{data:{subscription:u}}=a.auth.onAuthStateChange((y,h)=>{e(h?.user||null),y==="SIGNED_OUT"&&s(null)});return()=>u.unsubscribe()},[]),{user:t,loading:n,error:o,signIn:async(u,y)=>{try{s(null);const h=await f.signIn(u,y);if(h.error)throw new Error(h.error.message||"Failed to sign in");return h.data}catch(h){throw s(h instanceof Error?h.message:"Sign in failed"),h}},signOut:async()=>{try{s(null);const u=await f.signOut();if(u.error)throw new Error(u.error.message||"Failed to sign out")}catch(u){throw s(u instanceof Error?u.message:"Sign out failed"),u}},isAuthenticated:!!t}},I={sm:"w-4 h-4",md:"w-6 h-6",lg:"w-8 h-8",xl:"w-12 h-12"},v={indigo:"text-indigo-400 border-indigo-400",emerald:"text-emerald-400 border-emerald-400",yellow:"text-yellow-400 border-yellow-400",violet:"text-violet-400 border-violet-400",amber:"text-amber-400 border-amber-400"},F=({size:t="md",variant:e="default",color:n="indigo",text:c,fullScreen:o=!1,className:s=""})=>{const i=()=>{const u=`${I[t]} ${v[n]} ${s}`;switch(e){case"pulse":return r.jsx(g.div,{className:`${u} rounded-full bg-current`,animate:{scale:[1,1.2,1],opacity:[.7,1,.7]},transition:{duration:1.5,repeat:1/0,ease:"easeInOut"}});case"dots":return r.jsx("div",{className:"flex space-x-1",children:[0,1,2].map(y=>r.jsx(g.div,{className:`w-2 h-2 ${v[n].split(" ")[0]} rounded-full bg-current`,animate:{y:[0,-8,0],opacity:[.7,1,.7]},transition:{duration:.6,repeat:1/0,delay:y*.1,ease:"easeInOut"}},y))});case"spinner":return r.jsx(g.div,{className:`${u} border-2 border-current border-t-transparent rounded-full`,animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"}});default:return r.jsx(g.div,{animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"},children:r.jsx(x,{className:u})})}},l=r.jsxs("div",{className:"flex flex-col items-center justify-center space-y-4",children:[i(),c&&r.jsx(g.p,{className:`text-sm font-medium ${v[n].split(" ")[0]} uppercase tracking-wider`,initial:{opacity:0},animate:{opacity:1},transition:{delay:.2},children:c})]});return o?r.jsx(g.div,{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:r.jsx("div",{className:"bg-gray-900/90 backdrop-blur-sm border border-gray-700/40 rounded-2xl p-8",children:l})}):l};class G extends d.Component{constructor(e){super(e),this.state={hasError:!1}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,n){console.error("Error caught by boundary:",e,n),this.setState({error:e,errorInfo:n}),this.props.onError&&this.props.onError(e,n)}handleRetry=()=>{this.setState({hasError:!1,error:void 0,errorInfo:void 0})};handleGoHome=()=>{window.location.href="/"};handleReportError=()=>{const e={error:this.state.error?.message,stack:this.state.error?.stack,componentStack:this.state.errorInfo?.componentStack,timestamp:new Date().toISOString(),userAgent:navigator.userAgent,url:window.location.href};console.error("Error Report:",e),alert("Error report logged to console. Please contact support if the issue persists.")};render(){return this.state.hasError?this.props.fallback?this.props.fallback:r.jsx("div",{className:"min-h-screen bg-gradient-to-br from-red-950 via-red-900 to-gray-900 flex items-center justify-center px-4",children:r.jsxs(g.div,{className:"max-w-2xl w-full bg-red-900/30 backdrop-blur-sm border border-red-700/30 rounded-2xl overflow-hidden",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6},children:[r.jsx("div",{className:"bg-red-800/30 px-8 py-6 border-b border-red-700/30",children:r.jsxs("div",{className:"flex items-center space-x-4",children:[r.jsx("div",{className:"w-16 h-16 bg-red-600/30 rounded-2xl flex items-center justify-center",children:r.jsx(w,{className:"w-8 h-8 text-red-400"})}),r.jsxs("div",{children:[r.jsx("h1",{className:"text-2xl font-bold text-white heading-block uppercase",children:"Something Went Wrong"}),r.jsx("p",{className:"text-red-200 mt-1",children:"The application encountered an unexpected error"})]})]})}),r.jsxs("div",{className:"p-8",children:[r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{children:[r.jsx("h2",{className:"text-lg font-semibold text-white mb-3",children:"What happened?"}),r.jsx("div",{className:"bg-red-800/20 border border-red-600/30 rounded-lg p-4",children:r.jsx("p",{className:"text-red-200 text-sm font-mono",children:this.state.error?.message||"An unknown error occurred"})})]}),r.jsxs("div",{children:[r.jsx("h2",{className:"text-lg font-semibold text-white mb-3",children:"What can you do?"}),r.jsxs("ul",{className:"text-red-200 space-y-2",children:[r.jsxs("li",{className:"flex items-start space-x-2",children:[r.jsx("span",{className:"w-2 h-2 bg-red-400 rounded-full mt-2 flex-shrink-0"}),r.jsx("span",{children:"Try refreshing the page or retrying the action"})]}),r.jsxs("li",{className:"flex items-start space-x-2",children:[r.jsx("span",{className:"w-2 h-2 bg-red-400 rounded-full mt-2 flex-shrink-0"}),r.jsx("span",{children:"Check your internet connection"})]}),r.jsxs("li",{className:"flex items-start space-x-2",children:[r.jsx("span",{className:"w-2 h-2 bg-red-400 rounded-full mt-2 flex-shrink-0"}),r.jsx("span",{children:"Contact support if the problem persists"})]})]})]}),!1]}),r.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 mt-8 pt-6 border-t border-red-700/30",children:[r.jsxs(g.button,{onClick:this.handleRetry,className:"flex items-center justify-center px-6 py-3 bg-red-600 hover:bg-red-500 text-white font-semibold rounded-lg transition-colors",whileHover:{scale:1.02},whileTap:{scale:.98},children:[r.jsx(_,{className:"w-5 h-5 mr-2"}),"Try Again"]}),r.jsxs(g.button,{onClick:this.handleGoHome,className:"flex items-center justify-center px-6 py-3 bg-gray-700 hover:bg-gray-600 text-white font-semibold rounded-lg transition-colors",whileHover:{scale:1.02},whileTap:{scale:.98},children:[r.jsx(j,{className:"w-5 h-5 mr-2"}),"Go Home"]}),r.jsxs(g.button,{onClick:this.handleReportError,className:"flex items-center justify-center px-6 py-3 bg-transparent border border-red-600/50 hover:bg-red-600/10 text-red-300 font-semibold rounded-lg transition-colors",whileHover:{scale:1.02},whileTap:{scale:.98},children:[r.jsx(E,{className:"w-5 h-5 mr-2"}),"Report Issue"]})]}),r.jsx("div",{className:"mt-6 pt-6 border-t border-red-700/30 text-center",children:r.jsx("p",{className:"text-red-300 text-sm",children:"If this error persists, please contact the BLKOUT technical team"})})]})]})}):this.props.children}}export{G as E,F as L,f as a,T as b,O as c,P as d,a as s,D as u};
