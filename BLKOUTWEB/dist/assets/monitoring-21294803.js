var e=Object.defineProperty,t=(t,a,s)=>(((t,a,s)=>{a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[a]=s})(t,"symbol"!=typeof a?a+"":a,s),s);import{r as a}from"./vendor-2c4ac583.js";import{c as s,s as r}from"./federation-b9e22461.js";const i=new class{constructor(){t(this,"metrics",[]),t(this,"pageLoadMetrics",[]),t(this,"serviceMetrics",[]),t(this,"maxMetricsHistory",1e3),t(this,"alertThresholds",{pageLoadTime:2e3,serviceResponseTime:1e3,availability:.999,errorRate:.01}),this.startPerformanceCollection()}startPerformanceCollection(){setInterval(()=>{this.collectSystemMetrics(),this.collectServiceMetrics()},1e4),setInterval(()=>{this.cleanupOldMetrics()},3e5)}trackPageLoad(e,t,a=[],s=[]){const r=Date.now()-t,i={page:e,loadTime:r,contentLoadTime:this.measureContentLoadTime(),servicesUsed:a,fallbacksUsed:s,timestamp:new Date};this.pageLoadMetrics.push(i),this.addMetric({name:`page_load_${e}`,value:r,unit:"ms",timestamp:new Date,threshold:this.alertThresholds.pageLoadTime,status:r<this.alertThresholds.pageLoadTime?"good":r<1.5*this.alertThresholds.pageLoadTime?"warning":"critical"}),r>this.alertThresholds.pageLoadTime&&(console.warn(`Page load time exceeded threshold: ${e} took ${r}ms`),this.triggerAlert("page_load_slow",{page:e,loadTime:r,threshold:this.alertThresholds.pageLoadTime}))}measureContentLoadTime(){if("undefined"!=typeof window&&window.performance){const e=window.performance.getEntriesByType("navigation")[0];if(e)return e.loadEventEnd-e.loadEventStart}return 0}trackFeatureExecution(e,t,a,s,r=[]){const i={name:`feature_${e}`,value:t,unit:"ms",timestamp:new Date,status:a?t<500?"good":"warning":"critical"};this.addMetric(i),r.length>0&&this.addMetric({name:`enhancement_${e}`,value:s?1:0,unit:"boolean",timestamp:new Date,status:s?"good":"warning"})}collectSystemMetrics(){if("undefined"!=typeof performance&&performance.memory){const e=performance.memory;this.addMetric({name:"memory_used",value:e.usedJSHeapSize/1024/1024,unit:"MB",timestamp:new Date,status:e.usedJSHeapSize/e.jsHeapSizeLimit<.8?"good":"warning"})}const e=s.getConnectionStats(),t=Object.values(e).reduce((e,t)=>e+t.activeConnections,0);this.addMetric({name:"active_connections",value:t,unit:"count",timestamp:new Date,status:t<10?"good":"warning"})}async collectServiceMetrics(){const e=r.getAllServices();for(const a of e)try{const e=Date.now(),t=await r.isServiceAvailable(a.name),s=Date.now()-e,i=r.getCircuitBreakerState(a.name),n={serviceName:a.name,responseTime:s,availability:t?1:0,errorRate:"open"===i?1:0,circuitBreakerState:i,timestamp:new Date};this.serviceMetrics.push(n),this.addMetric({name:`service_response_${a.name}`,value:s,unit:"ms",timestamp:new Date,threshold:this.alertThresholds.serviceResponseTime,status:s<this.alertThresholds.serviceResponseTime?"good":"warning"}),this.addMetric({name:`service_availability_${a.name}`,value:t?1:0,unit:"boolean",timestamp:new Date,status:t?"good":"critical"})}catch(t){console.error(`Failed to collect metrics for ${a.name}:`,t)}}addMetric(e){this.metrics.push(e),this.metrics.length>this.maxMetricsHistory&&(this.metrics=this.metrics.slice(-this.maxMetricsHistory))}cleanupOldMetrics(){const e=new Date(Date.now()-36e5);this.metrics=this.metrics.filter(t=>t.timestamp>e),this.pageLoadMetrics=this.pageLoadMetrics.filter(t=>t.timestamp>e),this.serviceMetrics=this.serviceMetrics.filter(t=>t.timestamp>e)}triggerAlert(e,t){const a={type:e,data:t,timestamp:new Date,severity:this.getAlertSeverity(e)};console.warn("Performance Alert:",a)}getAlertSeverity(e){switch(e){case"page_load_slow":case"error_rate_high":return"high";case"service_unavailable":case"memory_high":return"medium";default:return"low"}}getCurrentMetrics(){const e=new Date,t=new Date(e.getTime()-3e5),a=this.metrics.filter(e=>e.timestamp>t);return{timestamp:e.toISOString(),platform:{averagePageLoadTime:this.getAveragePageLoadTime(),systemHealth:this.getSystemHealthScore(),serviceAvailability:this.getServiceAvailability(),independenceRatio:this.getIndependenceRatio()},services:this.getServiceSummary(),performance:{pageLoads:this.pageLoadMetrics.slice(-10),recentMetrics:a.slice(-20)}}}getAveragePageLoadTime(){const e=this.pageLoadMetrics.slice(-10);if(0===e.length)return 0;const t=e.reduce((e,t)=>e+t.loadTime,0);return Math.round(t/e.length)}getSystemHealthScore(){const e=this.metrics.filter(e=>e.timestamp>new Date(Date.now()-3e5));if(0===e.length)return 1;const t=e.filter(e=>"good"===e.status).length;return Math.round(t/e.length*100)/100}getServiceAvailability(){const e={},t=r.getAllServices();for(const a of t){const t=this.serviceMetrics.filter(e=>e.serviceName===a.name).slice(-10);if(t.length>0){const s=t.filter(e=>1===e.availability).length;e[a.name]=Math.round(s/t.length*100)/100}else e[a.name]=0}return e}getIndependenceRatio(){const e=this.pageLoadMetrics.slice(-20);if(0===e.length)return 1;const t=e.filter(e=>0===e.servicesUsed.length||e.fallbacksUsed.length>0).length;return Math.round(t/e.length*100)/100}getServiceSummary(){const e={},t=r.getAllServices();for(const a of t){const t=this.serviceMetrics.filter(e=>e.serviceName===a.name).slice(-10);if(t.length>0){const s=t.reduce((e,t)=>e+t.responseTime,0)/t.length,r=t.filter(e=>1===e.availability).length/t.length,i=t[t.length-1].circuitBreakerState;e[a.name]={averageResponseTime:Math.round(s),availability:Math.round(100*r)/100,circuitBreakerState:i,lastChecked:t[t.length-1].timestamp}}else e[a.name]={averageResponseTime:null,availability:0,circuitBreakerState:"unknown",lastChecked:null}}return e}async runPerformanceTest(){console.log("Running performance test...");const e={pageLoadTimes:[],serviceResponseTimes:[],independenceTest:null,timestamp:(new Date).toISOString()},t=["/","/governance","/ecosystem","/moderation"];for(const r of t){const t=Date.now();await this.delay(100+500*Math.random());const a=Date.now()-t;e.pageLoadTimes.push({page:r,loadTime:a,passesThreshold:a<this.alertThresholds.pageLoadTime})}const a=r.getAllServices();for(const n of a)try{const t=Date.now(),a=await r.isServiceAvailable(n.name),s=Date.now()-t;e.serviceResponseTimes.push({service:n.name,responseTime:s,available:a,passesThreshold:s<this.alertThresholds.serviceResponseTime})}catch(i){e.serviceResponseTimes.push({service:n.name,responseTime:null,available:!1,error:i instanceof Error?i.message:"Unknown error"})}r.clearHealthCache();const s=Date.now();try{const t=["governance","moderation","content_submission"],a=[];for(const e of t){const t=Date.now();await this.delay(50+200*Math.random());const s=Date.now()-t;a.push({feature:e,executionTime:s,success:!0,workingIndependently:!0})}e.independenceTest={totalTime:Date.now()-s,features:a,allFeaturesWorking:a.every(e=>e.success),averageExecutionTime:a.reduce((e,t)=>e+t.executionTime,0)/a.length}}catch(i){e.independenceTest={error:i instanceof Error?i.message:"Independence test failed",success:!1}}return console.log("Performance test completed:",e),e}delay(e){return new Promise(t=>setTimeout(t,e))}getHealthCheck(){const e=this.getCurrentMetrics();return{status:e.platform.systemHealth>.8?"healthy":"degraded",timestamp:(new Date).toISOString(),platform:{systemHealth:e.platform.systemHealth,averagePageLoadTime:e.platform.averagePageLoadTime,independenceRatio:e.platform.independenceRatio},services:e.services,alerts:this.getActiveAlerts()}}getActiveAlerts(){return[]}};function n(){const[e,t]=a.useState([]),[s,i]=a.useState(0),[n,o]=a.useState(!0),c=a.useCallback(async()=>{o(!0);try{const e=r.getAllServices(),a=await Promise.all(e.map(async e=>{try{const t=await r.isServiceAvailable(e.name),a=r.getServiceHealth(e.name),s=r.getCircuitBreakerState(e.name);return{name:e.name,available:t,responseTime:a?.responseTime||null,status:a?.status||"unknown",circuitBreakerState:s,capabilities:e.capabilities,lastChecked:a?.lastChecked||new Date}}catch(t){return{name:e.name,available:!1,error:t instanceof Error?t.message:"Unknown error",circuitBreakerState:"unknown",capabilities:e.capabilities,lastChecked:new Date}}}));t(a);const s=a.filter(e=>e.available).length/a.length;i(s)}catch(e){console.error("Health check failed:",e),t([]),i(0)}finally{o(!1)}},[]);return a.useEffect(()=>{c();const e=setInterval(c,3e4);return()=>clearInterval(e)},[c]),{services:e,overallHealth:s,loading:n,refresh:c}}function o(){const[e,t]=a.useState(null),[s,r]=a.useState(!0),n=a.useCallback(()=>{try{const e=i.getCurrentMetrics();t(e)}catch(e){console.error("Failed to load performance metrics:",e),t(null)}finally{r(!1)}},[]),o=a.useCallback(async()=>{r(!0);try{return await i.runPerformanceTest()}catch(e){throw console.error("Performance test failed:",e),e}finally{r(!1),n()}},[n]);return a.useEffect(()=>{n();const e=setInterval(n,1e4);return()=>clearInterval(e)},[n]),{metrics:e,loading:s,refresh:n,runPerformanceTest:o}}export{o as a,i as p,n as u};
//# sourceMappingURL=monitoring-21294803.js.map
